
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>YAML Blueprint Advanced Example Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-bootstrap-callout/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../website-1507894547703.css">
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="blueprinting-tips.html" />
    
    
    <link rel="prev" href="salt/creating-salt-blueprints.html" />
    

    </head>
    <body>
        
    <header class="page-header">
        <a href="https://brooklyn.apache.org" class="navbar-brand">
            <img src="https://brooklyn.apache.org/v/latest/style/img/apache-brooklyn-logo-244px-wide.png" alt="Apache Brooklyn">
        </a>
    </header>
    
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">User Guide</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../start/">
            
                <a href="../start/">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../start/running.html">
            
                <a href="../start/running.html">
            
                    
                    Running Apache Brooklyn
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../start/blueprints.html">
            
                <a href="../start/blueprints.html">
            
                    
                    Deploying Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../start/managing.html">
            
                <a href="../start/managing.html">
            
                    
                    Monitoring and Managing Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../start/policies.html">
            
                <a href="../start/policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../start/concept-quickstart.html">
            
                <a href="../start/concept-quickstart.html">
            
                    
                    Concepts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../misc/download.html">
            
                <a href="../misc/download.html">
            
                    
                    Downloads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../concepts/">
            
                <a href="../concepts/">
            
                    
                    Brooklyn Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../concepts/entities.html">
            
                <a href="../concepts/entities.html">
            
                    
                    Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../concepts/application-parent-membership.html">
            
                <a href="../concepts/application-parent-membership.html">
            
                    
                    Application, Parent and Membership
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../concepts/configuration-sensor-effectors.html">
            
                <a href="../concepts/configuration-sensor-effectors.html">
            
                    
                    Configuration, Sensors and Effectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../concepts/lifecycle-managementcontext.html">
            
                <a href="../concepts/lifecycle-managementcontext.html">
            
                    
                    Lifecycle and ManagementContext
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../concepts/dependent-configuration.html">
            
                <a href="../concepts/dependent-configuration.html">
            
                    
                    Dependent Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../concepts/location.html">
            
                <a href="../concepts/location.html">
            
                    
                    Location
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../concepts/policies.html">
            
                <a href="../concepts/policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../concepts/execution.html">
            
                <a href="../concepts/execution.html">
            
                    
                    Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../concepts/stop-start-restart-behaviour.html">
            
                <a href="../concepts/stop-start-restart-behaviour.html">
            
                    
                    Stop/start/restart behaviour
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Writing Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="creating-yaml.html">
            
                <a href="creating-yaml.html">
            
                    
                    Creating YAML Blueprint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="entity-configuration.html">
            
                <a href="entity-configuration.html">
            
                    
                    Entity Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="setting-locations.html">
            
                <a href="setting-locations.html">
            
                    
                    Setting Locations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="configuring-vms.html">
            
                <a href="configuring-vms.html">
            
                    
                    Configuring VMs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="multiple-services.html">
            
                <a href="multiple-services.html">
            
                    
                    Multiple Services and Dependency Injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="custom-entities.html">
            
                <a href="custom-entities.html">
            
                    
                    Custom Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="catalog/">
            
                <a href="catalog/">
            
                    
                    Catalog
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.1" data-path="catalog/schema.html">
            
                <a href="catalog/schema.html">
            
                    
                    Catalog Items YAML Syntax
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.2" data-path="catalog/templates.html">
            
                <a href="catalog/templates.html">
            
                    
                    Templates and the Add-Application Wizard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3" data-path="catalog/versioning.html">
            
                <a href="catalog/versioning.html">
            
                    
                    Versioning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.4" data-path="catalog/management.html">
            
                <a href="catalog/management.html">
            
                    
                    Catalog Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.5" data-path="catalog/bundle.html">
            
                <a href="catalog/bundle.html">
            
                    
                    Bundling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.6" data-path="catalog/cli.html">
            
                <a href="catalog/cli.html">
            
                    
                    Brooklyn Server Command Line Arguments
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="clusters.html">
            
                <a href="clusters.html">
            
                    
                    Clusters, Specs, and Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="enrichers.html">
            
                <a href="enrichers.html">
            
                    
                    Enrichers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="policies.html">
            
                <a href="policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="effectors.html">
            
                <a href="effectors.html">
            
                    
                    Effectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="clusters-and-policies.html">
            
                <a href="clusters-and-policies.html">
            
                    
                    Clusters and Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="java/">
            
                <a href="java/">
            
                    
                    Java Entities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="java/archetype.html">
            
                <a href="java/archetype.html">
            
                    
                    Creating from a Maven Archetype
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.2" data-path="java/defining-and-deploying.html">
            
                <a href="java/defining-and-deploying.html">
            
                    
                    Defining and Deploying
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.3" data-path="java/bundle-dependencies.html">
            
                <a href="java/bundle-dependencies.html">
            
                    
                    Handling Bundle Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.4" data-path="java/topology-dependencies.html">
            
                <a href="java/topology-dependencies.html">
            
                    
                    Topology, Dependencies, and Management Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.5" data-path="java/common-usage.html">
            
                <a href="java/common-usage.html">
            
                    
                    Common Classes and Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.6" data-path="java/feeds.html">
            
                <a href="java/feeds.html">
            
                    
                    Feeds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.7" data-path="java/entity.html">
            
                <a href="java/entity.html">
            
                    
                    Writing an Entity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.8" data-path="java/entities.html">
            
                <a href="java/entities.html">
            
                    
                    Custom Entity Development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.9" data-path="java/service-state.html">
            
                <a href="java/service-state.html">
            
                    
                    Service State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.10" data-path="java/entitlements.html">
            
                <a href="java/entitlements.html">
            
                    
                    Entitlements
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="winrm/">
            
                <a href="winrm/">
            
                    
                    Windows Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.14.1" data-path="winrm/client.html">
            
                <a href="winrm/client.html">
            
                    
                    Winrm4j Client
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="test/">
            
                <a href="test/">
            
                    
                    Testing YAML Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.15.1" data-path="test/test-entities.html">
            
                <a href="test/test-entities.html">
            
                    
                    Test Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.2" data-path="test/usage-examples.html">
            
                <a href="test/usage-examples.html">
            
                    
                    Example Tests
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="ansible/">
            
                <a href="ansible/">
            
                    
                    Ansible in YAML Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.16.1" data-path="ansible/about-ansible.html">
            
                <a href="ansible/about-ansible.html">
            
                    
                    About Ansible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16.2" data-path="ansible/creating-ansible-blueprints.html">
            
                <a href="ansible/creating-ansible-blueprints.html">
            
                    
                    Creating Blueprints with Ansible
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="chef/">
            
                <a href="chef/">
            
                    
                    Chef in YAML Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.17.1" data-path="chef/about-chef.html">
            
                <a href="chef/about-chef.html">
            
                    
                    About Chef
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17.2" data-path="chef/creating-blueprints.html">
            
                <a href="chef/creating-blueprints.html">
            
                    
                    Creating Blueprints from Chef
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17.3" data-path="chef/writing-chef.html">
            
                <a href="chef/writing-chef.html">
            
                    
                    Writing Chef for Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17.4" data-path="chef/advanced-chef-integration.html">
            
                <a href="chef/advanced-chef-integration.html">
            
                    
                    Advanced Chef Integration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="salt/">
            
                <a href="salt/">
            
                    
                    Salt in YAML Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.18.1" data-path="salt/about-salt.html">
            
                <a href="salt/about-salt.html">
            
                    
                    About Salt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18.2" data-path="salt/creating-salt-blueprints.html">
            
                <a href="salt/creating-salt-blueprints.html">
            
                    
                    Creating Blueprints with Salt
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5.19" data-path="advanced-example.html">
            
                <a href="advanced-example.html">
            
                    
                    YAML Blueprint Advanced Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="blueprinting-tips.html">
            
                <a href="blueprinting-tips.html">
            
                    
                    Blueprinting Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21" data-path="yaml-reference.html">
            
                <a href="yaml-reference.html">
            
                    
                    YAML Blueprint Reference
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../locations/">
            
                <a href="../locations/">
            
                    
                    Deploying Blueprint
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../locations/">
            
                <a href="../locations/#clouds">
            
                    
                    Clouds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../locations/">
            
                <a href="../locations/#amazon-web-services-aws">
            
                    
                    Amazon Web Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../locations/">
            
                <a href="../locations/#azure-compute-arm">
            
                    
                    Azure Compute ARM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../locations/">
            
                <a href="../locations/#azure-compute-classic">
            
                    
                    Azure Compute Classic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../locations/">
            
                <a href="../locations/#apache-cloudstack">
            
                    
                    Apache CloudStack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../locations/">
            
                <a href="../locations/#google-compute-engine-gce">
            
                    
                    Google Compute Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../locations/">
            
                <a href="../locations/#ibm-softlayer">
            
                    
                    IBM Softlayer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../locations/">
            
                <a href="../locations/#openstack">
            
                    
                    OpenStack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../locations/">
            
                <a href="../locations/#named-locations">
            
                    
                    Named Locations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../locations/">
            
                <a href="../locations/#inheritance-and-named-locations">
            
                    
                    Provisioned Machine Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../locations/">
            
                <a href="../locations/#byon">
            
                    
                    BYON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../locations/">
            
                <a href="../locations/#ssh-keys">
            
                    
                    SSH Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../locations/">
            
                <a href="../locations/#localhost">
            
                    
                    Localhost
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../locations/">
            
                <a href="../locations/#location-customizers">
            
                    
                    Location Customizers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../locations/">
            
                <a href="../locations/#customizing-cloud-security-groups">
            
                    
                    Customizing Cloud Security Groups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../locations/">
            
                <a href="../locations/#specialized-locations">
            
                    
                    Specialized Locations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../ops/">
            
                <a href="../ops/">
            
                    
                    Reference Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../ops/production-installation.html">
            
                <a href="../ops/production-installation.html">
            
                    
                    Production Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../ops/starting-stopping-monitoring.html">
            
                <a href="../ops/starting-stopping-monitoring.html">
            
                    
                    Starting, Stopping and Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../ops/server-cli-reference.html">
            
                <a href="../ops/server-cli-reference.html">
            
                    
                    Server CLI Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../ops/cli/">
            
                <a href="../ops/cli/">
            
                    
                    Client CLI Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.4.1" data-path="../ops/cli/cli-ref-guide.html">
            
                <a href="../ops/cli/cli-ref-guide.html">
            
                    
                    CLI Reference Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4.2" data-path="../ops/cli/cli-usage-guide.html">
            
                <a href="../ops/cli/cli-usage-guide.html">
            
                    
                    CLI Usage Guide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../ops/gui/">
            
                <a href="../ops/gui/">
            
                    
                    GUI Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.5.1" data-path="../ops/gui/running.html">
            
                <a href="../ops/gui/running.html">
            
                    
                    Launching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.2" data-path="../ops/gui/blueprints.html">
            
                <a href="../ops/gui/blueprints.html">
            
                    
                    Deploying Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.3" data-path="../ops/gui/managing.html">
            
                <a href="../ops/gui/managing.html">
            
                    
                    Monitoring and Managing Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.4" data-path="../ops/gui/policies.html">
            
                <a href="../ops/gui/policies.html">
            
                    
                    Using Policies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../ops/rest.html">
            
                <a href="../ops/rest.html">
            
                    
                    REST API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../ops/configuration/">
            
                <a href="../ops/configuration/">
            
                    
                    Configuring Brooklyn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="../ops/configuration/">
            
                <a href="../ops/configuration/#memory-usage">
            
                    
                    Memory Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.2" data-path="../ops/configuration/">
            
                <a href="../ops/configuration/#authentication-and-security">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.3" data-path="../ops/configuration/brooklyn_cfg.html">
            
                <a href="../ops/configuration/brooklyn_cfg.html">
            
                    
                    brooklyn.cfg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.4" data-path="../ops/configuration/https.html">
            
                <a href="../ops/configuration/https.html">
            
                    
                    HTTPS Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7.5" data-path="../ops/configuration/cors.html">
            
                <a href="../ops/configuration/cors.html">
            
                    
                    CORS Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../ops/persistence/">
            
                <a href="../ops/persistence/">
            
                    
                    Persistence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../ops/high-availability/">
            
                <a href="../ops/high-availability/">
            
                    
                    High Availability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.9.1" data-path="../ops/high-availability/high-availability-supplemental.html">
            
                <a href="../ops/high-availability/high-availability-supplemental.html">
            
                    
                    Configuring HA - an example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../ops/logging.html">
            
                <a href="../ops/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../ops/externalized-configuration.html">
            
                <a href="../ops/externalized-configuration.html">
            
                    
                    Externalized Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../ops/requirements.html">
            
                <a href="../ops/requirements.html">
            
                    
                    Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../ops/upgrade.html">
            
                <a href="../ops/upgrade.html">
            
                    
                    Upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../ops/security-guidelines.html">
            
                <a href="../ops/security-guidelines.html">
            
                    
                    Security Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../ops/troubleshooting/">
            
                <a href="../ops/troubleshooting/">
            
                    
                    Troubleshooting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.15.1" data-path="../ops/troubleshooting/overview.html">
            
                <a href="../ops/troubleshooting/overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.2" data-path="../ops/troubleshooting/web-console-issues.html">
            
                <a href="../ops/troubleshooting/web-console-issues.html">
            
                    
                    Web Console Issues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.3" data-path="../ops/troubleshooting/deployment.html">
            
                <a href="../ops/troubleshooting/deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.4" data-path="../ops/troubleshooting/connectivity.html">
            
                <a href="../ops/troubleshooting/connectivity.html">
            
                    
                    Server Connectivity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.5" data-path="../ops/troubleshooting/slow-unresponsive.html">
            
                <a href="../ops/troubleshooting/slow-unresponsive.html">
            
                    
                    Brooklyn Slow or Unresponsive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.6" data-path="../ops/troubleshooting/increase-entropy.html">
            
                <a href="../ops/troubleshooting/increase-entropy.html">
            
                    
                    Increase Entropy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.7" data-path="../ops/troubleshooting/increase-system-resource-limits.html">
            
                <a href="../ops/troubleshooting/increase-system-resource-limits.html">
            
                    
                    Increase System Resource Limits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.8" data-path="../ops/troubleshooting/detailed-support-report.html">
            
                <a href="../ops/troubleshooting/detailed-support-report.html">
            
                    
                    Detailed Support Report
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.9" data-path="../ops/troubleshooting/softwareprocess.html">
            
                <a href="../ops/troubleshooting/softwareprocess.html">
            
                    
                    SoftwareProcess Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.10" data-path="../ops/troubleshooting/going-deep-in-java-and-logs.html">
            
                <a href="../ops/troubleshooting/going-deep-in-java-and-logs.html">
            
                    
                    Going Deep in Java and Logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15.11" data-path="../ops/troubleshooting/memory-usage.html">
            
                <a href="../ops/troubleshooting/memory-usage.html">
            
                    
                    Monitoring Memory Usage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../misc/">
            
                <a href="../misc/">
            
                    
                    Other 0.12.0 Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" >
            
                <a target="_blank" href="https://brooklyn.apache.org/meta/versions.html">
            
                    
                    Versions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../misc/release-notes.html">
            
                <a href="../misc/release-notes.html">
            
                    
                    Release Notes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Developer Guide</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://brooklyn.apache.org/developers/code/">
            
                    
                    Get the Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../dev/env/maven-build.html">
            
                <a href="../dev/env/maven-build.html">
            
                    
                    Maven Build
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../dev/env/ide/">
            
                <a href="../dev/env/ide/">
            
                    
                    IDE Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../dev/code/structure.html">
            
                <a href="../dev/code/structure.html">
            
                    
                    Code Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../dev/code/tests.html">
            
                <a href="../dev/code/tests.html">
            
                    
                    Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../dev/code/licensing.html">
            
                <a href="../dev/code/licensing.html">
            
                    
                    License Considerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../dev/tips/">
            
                <a href="../dev/tips/">
            
                    
                    Miscellaneous Tips and Tricks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../dev/tips/logging.html">
            
                <a href="../dev/tips/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../dev/tips/debugging-remote-brooklyn.html">
            
                <a href="../dev/tips/debugging-remote-brooklyn.html">
            
                    
                    Brooklyn Remote Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" >
            
                <a target="_blank" href="http://github.com/apache/brooklyn">
            
                    
                    GitHub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" >
            
                <a target="_blank" href="https://brooklyn.apache.org/v/latest/misc/javadoc">
            
                    
                    Javadoc
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://brooklyn.apache.org/documentation/other-docs.html">
            
                    
                    Other Resources
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >YAML Blueprint Advanced Example</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="yaml-blueprint-advanced-example">YAML Blueprint Advanced Example</h1>
<p>By this point you should be familiar with the fundamental concepts behind both Apache Brooklyn and <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a> blueprints. This section of the documentation is intended to show a complete, advanced example of a <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a> <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>.</p>
<p>The intention is that this example is used to learn the more in-depth concepts, and also to serve as a reference when writing your own blueprints. This page will first explain what the example application is and how to run it, then it will spotlight interesting features.</p>
<p>Please note, there is now a much more up-to-date ELK <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> that can be found <a href="https://github.com/brooklyncentral/brooklyn-elk/" target="_blank">here</a>. We&apos;ve using an older version of this in the tutorial as it highlights some key Brooklyn concepts.</p>
<h3 id="elk-stack-example">ELK Stack Example</h3>
<p>This example demonstrates the deployment of an ELK Stack (Elasticsearch, Logstash and Kibana), using the provided <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> to deploy, install, run and manage all three. Briefly, the component parts are:</p>
<ul>
<li>Elasticsearch: A clustered search engine</li>
<li>Logstash: Collects, parses and stores logs. For our example it will store logs in Elasticsearch</li>
<li>Kibana: A web front end to Elasticsearch</li>
</ul>
<p>We also deploy a simple webserver whose logs will be collected.</p>
<ul>
<li>Tomcat 8: Web server whose logs will be stored in Elasticsearch by Logstash.</li>
</ul>
<p>For more about the ELK stack, please see the documentation <a href="https://www.elastic.co/webinars/introduction-elk-stack" target="_blank">here</a>.</p>
<h4 id="the-blueprints">The Blueprints</h4>
<hr>
<p>There are four blueprints that make up this application. Each of them are used to add one or more catalog items to Brooklyn. You can find them below:</p>
<ul>
<li><a href="example_yaml/brooklyn-elasticsearch-catalog.bom">Elasticsearch</a></li>
<li><a href="example_yaml/brooklyn-logstash-catalog.bom">Logstash</a></li>
<li><a href="example_yaml/brooklyn-kibana-catalog.bom">Kibana</a></li>
<li><a href="example_yaml/brooklyn-elk-catalog.bom">ELK</a></li>
</ul>
<h4 id="running-the-example">Running the example</h4>
<p>First, add all four blueprints to the Brooklyn Catalog. This can be done by clicking the &apos;Catalog&apos; tab, clicking the &apos;+&apos;
 symbol and pasting the <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a>. Once this is done, click the &apos;Application&apos; tab, then the &apos;+&apos; button to bring up the add 
application wizard. A new Catalog application will be available called &apos;ELK Stack&apos;. Using the add application wizard, 
you should be able to deploy an ELK stack to a <a href="../GLOSSARY.html#location" class="glossary-term" title="A server or resource to which Apache Brooklyn can deploy applications">location</a> of your choosing.  Alternatively use the <code>br</code> Brooklyn
command line tool and add the files with <code>br catalog add</code>.</p>
<h4 id="exploring-the-example">Exploring the example</h4>
<p>After the application has been deployed, you can ensure it is working as expected by checking the following:</p>
<ul>
<li>There is a Kibana <a href="../GLOSSARY.html#sensor" class="glossary-term" title="A sensor is a property, or attribute of an Apache Brooklyn entity, updated in real-time.">sensor</a> called <code>main.uri</code>, the value of which points to the Kibana front end. You can explore this 
front end, and observe the logs stored in Elasticsearch. Many Brooklyn applications have a <code>main.uri</code> set to point you 
in the right direction.</li>
<li>You can also use the Elasticsearch REST API to explore further. The Elasticsearch Cluster <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> has a <code>urls.http.list</code> 
<a href="../GLOSSARY.html#sensor" class="glossary-term" title="A sensor is a property, or attribute of an Apache Brooklyn entity, updated in real-time.">sensor</a>. Using a host:port from that list you will be able to access the REST API. The following URL will give you the 
state of the cluster <code>http://&lt;host:port&gt;/_cluster/health?pretty=true</code>. As you can see the <code>number_of_nodes</code> is 
currently 2, indicating that the Elasticsearch nodes are communicating with each other.</li>
</ul>
<h3 id="interesting-feature-spotlight">Interesting Feature Spotlight</h3>
<p>We will mainly focus on the Elasticsearch <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>, and will be clear when another <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> is being discussed. This <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> describes a cluster of Elasticsearch nodes. </p>
<h4 id="provisioning-properties">Provisioning Properties</h4>
<p>Our Elasticsearch <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> has a few requirements of the <a href="../GLOSSARY.html#location" class="glossary-term" title="A server or resource to which Apache Brooklyn can deploy applications">location</a> in which it is run. Firstly, it must be run on an
Ubuntu machine as the example has been written specifically for this OS. Secondly, two ports must opened to ensure
that the entities can be accessed from the outside world. Both of these requirements are configured via 
<code>provisioning.properties</code> as follows:</p>
<pre><code class="lang-yaml">brooklyn.config:
  elasticsearch.http.port: <span class="hljs-number">9220</span>
  elasticsearch.tcp.port: <span class="hljs-number">9330</span>
  provisioning.properties:
<span class="hljs-attr">    osFamily:</span> ubuntu
<span class="hljs-attr">    inboundPorts:</span>
<span class="hljs-bullet">    -</span> $brooklyn:config(<span class="hljs-string">&quot;elasticsearch.http.port&quot;</span>)
<span class="hljs-bullet">    -</span> $brooklyn:config(<span class="hljs-string">&quot;elasticsearch.tcp.port&quot;</span>)
</code></pre>
<h4 id="vanillasoftwareprocess">VanillaSoftwareProcess</h4>
<p>When composing a <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a> <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>, the VanillaSoftwareProcess is a very useful <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> to be aware of. 
A VanillaSoftwareProcess will instruct Brooklyn to provision an instance, and run a series of shell 
commands to setup, run, monitor and teardown your program. The commands are specified as configuration 
on the VanillaSoftwareProcess and there are several available. We will spotlight a few now. To simplify
 this <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>, we have specified ubuntu only installs so that our commands can be tailored to this 
 system (e.g. use apt-get rather than yum).</p>
<h5 id="customize-command">Customize Command</h5>
<p>The Customize Command is run after the application has been installed but before it is run. It is the perfect
 place to create and amend config files. Please refer to the following section of the Elasticsearch <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>:</p>
<pre><code class="lang-yaml">customize.command: <span class="hljs-string">|
  sudo rm -fr sudo tee /etc/elasticsearch/elasticsearch.yml
  echo discovery.zen.ping.multicast.enabled: false | sudo tee -a /etc/elasticsearch/elasticsearch.yml
  echo discovery.zen.ping.unicast.enabled: true | sudo tee -a /etc/elasticsearch/elasticsearch.yml
  echo discovery.zen.ping.unicast.hosts: ${URLS_WITH_BRACKETS} | sudo tee -a /etc/elasticsearch/elasticsearch.yml
  echo http.port: ${ES_HTTP_PORT} | sudo tee -a /etc/elasticsearch/elasticsearch.yml
  echo transport.tcp.port: ${ES_TCP_PORT} | sudo tee -a /etc/elasticsearch/elasticsearch.yml
  echo network.host: ${IP_ADDRESS} | sudo tee -a /etc/elasticsearch/elasticsearch.yml
</span></code></pre>
<p>The purpose of this section is to create a <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a> file with all of the required configuration. We use the <a href="../GLOSSARY.html#yaml" class="glossary-term" title="A human-readable data format. See the Wikipedia article for more information.">YAML</a> 
literal style <code>|</code> indicator to write a multi line command. We start our series of commands by using the <code>rm</code> command to remove the 
previous config file. We then use <code>echo</code> and <code>tee</code> to create the new config file and insert the config. Part 
of the configuration is a list of all hosts that is set on the parent <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a>- this is done by using a combination
 of the <code>component</code> and  <code>attributeWhenReady</code> DSL commands. More on how this is generated later.</p>
<h5 id="check-running">Check running</h5>
<p>After an app is installed and run, this command is scheduled to run regularly and used to populate the <code>service.isUp</code> 
<a href="../GLOSSARY.html#sensor" class="glossary-term" title="A sensor is a property, or attribute of an Apache Brooklyn entity, updated in real-time.">sensor</a>. If this command is not specified, or returns an exit code of anything other than zero, then Brooklyn will 
assume that your <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> has failed and will display the fire status symbol. Please refer to the following section 
of the Elasticsearch <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>:</p>
<pre><code class="lang-yaml">checkRunning.command: sudo systemctl status kibana.service
</code></pre>
<p>There are many different ways to implement this command. For this example, we are simply using the systemctl status 
of the appropriate service.</p>
<h4 id="enrichers">Enrichers</h4>
<h5 id="elasticsearch-urls">Elasticsearch URLS</h5>
<p>To ensure that all Elasticsearch nodes can communicate with each other they need to be configured with the TCP URL 
of all other nodes. Similarly, the Logstash instances need to be configured with all the HTTP URLs of the Elasticsearch 
nodes. The mechanism for doing this is the same, and involves using Transformers, Aggregators and Joiners, as follows:</p>
<pre><code class="lang-yaml">brooklyn.enrichers:
<span class="hljs-attr">  - type:</span> org.apache.brooklyn.enricher.stock.Transformer
    brooklyn.config:
      enricher.sourceSensor: $brooklyn:sensor(<span class="hljs-string">&quot;host.subnet.address&quot;</span>)
      enricher.targetSensor: $brooklyn:sensor(<span class="hljs-string">&quot;url.tcp&quot;</span>)
      enricher.targetValue: $brooklyn:formatString(<span class="hljs-string">&quot;%s:%s&quot;</span>, $brooklyn:attributeWhenReady(<span class="hljs-string">&quot;host.subnet.address&quot;</span>), $brooklyn:config(<span class="hljs-string">&quot;elasticsearch.tcp.port&quot;</span>))
</code></pre>
<p>In this example, we take the host.subnet.address and append the TCP port, outputting the result as <code>url.tcp</code>. 
After this has been done, we now need to collect all the URLs into a list in the Cluster <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a>, as follows:</p>
<pre><code class="lang-yaml">brooklyn.enrichers:
<span class="hljs-attr">  - type:</span> org.apache.brooklyn.enricher.stock.Aggregator
    brooklyn.config:
      enricher.sourceSensor: $brooklyn:sensor(<span class="hljs-string">&quot;url.tcp&quot;</span>)
      enricher.targetSensor: $brooklyn:sensor(<span class="hljs-string">&quot;urls.tcp.list&quot;</span>)
      enricher.aggregating.fromMembers: <span class="hljs-literal">true</span>
</code></pre>
<p>In the preceding example, we aggregated all of the TCP URLs generated in the early example. 
These are then stored in a <a href="../GLOSSARY.html#sensor" class="glossary-term" title="A sensor is a property, or attribute of an Apache Brooklyn entity, updated in real-time.">sensor</a> called <code>urls.tcp.list</code>. This list is then joined together into one long string:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> org.apache.brooklyn.enricher.stock.Joiner
  brooklyn.config:
    enricher.sourceSensor: $brooklyn:sensor(<span class="hljs-string">&quot;urls.tcp.list&quot;</span>)
    enricher.targetSensor: $brooklyn:sensor(<span class="hljs-string">&quot;urls.tcp.string&quot;</span>)
<span class="hljs-attr">    uniqueTag:</span> urls.quoted.string
</code></pre>
<p>Finally, the string has brackets added to the start and end:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> org.apache.brooklyn.enricher.stock.Transformer
  brooklyn.config:
    enricher.sourceSensor: $brooklyn:sensor(<span class="hljs-string">&quot;urls.tcp.string&quot;</span>)
    enricher.targetSensor: $brooklyn:sensor(<span class="hljs-string">&quot;urls.tcp.withBrackets&quot;</span>)
    enricher.targetValue: $brooklyn:formatString(<span class="hljs-string">&quot;[%s]&quot;</span>, $brooklyn:attributeWhenReady(<span class="hljs-string">&quot;urls.tcp.string&quot;</span>))
</code></pre>
<p>The resulting <a href="../GLOSSARY.html#sensor" class="glossary-term" title="A sensor is a property, or attribute of an Apache Brooklyn entity, updated in real-time.">sensor</a> will be called <code>urls.tcp.withBrackets</code> and will be used by all Elasticsearch nodes during setup.</p>
<h5 id="kibana-url">Kibana URL</h5>
<p>Kibana also needs to be configured such that it can access the Elasticsearch cluster. However, Kibana can
 only be configured to point at one Elasticsearch instance. To enable this, we use another <a href="../GLOSSARY.html#enricher" class="glossary-term" title="Generates new events or sensor values (metrics) for an entity, usually by aggregating 
or modifying data from one or more other sensors.">enricher</a> in the 
 cluster to select the first URL from the list, as follows:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> org.apache.brooklyn.enricher.stock.Aggregator
  brooklyn.config:
    enricher.sourceSensor: $brooklyn:sensor(<span class="hljs-string">&quot;host.subnet.address&quot;</span>)
    enricher.targetSensor: $brooklyn:sensor(<span class="hljs-string">&quot;host.address.first&quot;</span>)
    enricher.aggregating.fromMembers: <span class="hljs-literal">true</span>
    enricher.transformation:
     $brooklyn:object:
<span class="hljs-attr">       type:</span> <span class="hljs-string">&quot;org.apache.brooklyn.util.collections.CollectionFunctionals$FirstElementFunction&quot;</span>
</code></pre>
<p>Similar to the above Aggregator, this Aggregator collects all the URLs from the members of the cluster. 
However, this Aggregator specifies a transformation. In this instance a transformation is a Java class that 
implements a Guava Function <code>&lt;? super Collection&lt;?&gt;, ?&gt;&gt;</code>, i.e. a function that takes in a collection and 
returns something. In this case we specify the FirstElementFunction from the CollectionFunctionals to ensure 
that we only get the first member of the URL list.</p>
<h4 id="latches">Latches</h4>
<p>In the ELK <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a>, there is a good example of a latch. Latches are used to force an <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> to wait until 
certain conditions are met before continuing. For example:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> kibana-standalone
<span class="hljs-attr">  id:</span> kibana
<span class="hljs-attr">  name:</span> Kibana Server
  latch.customize: $brooklyn:component(<span class="hljs-string">&quot;es&quot;</span>).attributeWhenReady(<span class="hljs-string">&quot;service.isUp&quot;</span>)
</code></pre>
<p>This latch is used to stop Kibana customizing until the Elasticsearch cluster is up. We do this to ensure 
that the URL sensors have been setup, so that they can be passed into Kibana during the customization phase.</p>
<p>Latches can also be used to control how many entities can execute the same step at any given moment. When
a latch is given the value of a <code>MaxConcurrencySensor</code> it will unblock execution only when there are
available &quot;slots&quot; to execute (think of it as a semaphore). For example to let a single <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> execute the
launch step of the start <a href="../GLOSSARY.html#effector" class="glossary-term" title="Effectors are tools Apache Brooklyn provides, that allow you to manipulate the live entities within an application.
They are operations applied on entities.">effector</a>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">services:</span>
<span class="hljs-attr">- type:</span> cluster

  brooklyn.initializers:
<span class="hljs-attr">  - type:</span> org.apache.brooklyn.core.sensor.MaxConcurrencySensor
    brooklyn.config:
<span class="hljs-attr">      name:</span> single-executor
      latch.concurrency.max: <span class="hljs-number">1</span>

  brooklyn.config: 
<span class="hljs-attr">    initialSize:</span> <span class="hljs-number">10</span>
<span class="hljs-attr">    memberSpec:</span>
      $brooklyn:entitySpec:
<span class="hljs-attr">        type:</span> vanilla-bash-server
        brooklyn.config:
          launch.command: sleep <span class="hljs-number">2</span>
          checkRunning.command: <span class="hljs-literal">true</span>
          latch.launch: $brooklyn:parent().attributeWhenReady(<span class="hljs-string">&quot;single-executor&quot;</span>)
</code></pre>
<p>It&apos;s important to note that the above setup is not reentrant. This means that users should be careful to
avoid deadlocks. For example having a start and launch latches against the <code>single-executor</code> from above.
The launch latch will block forever since the start latch already would&apos;ve acquired the free slot.</p>
<h4 id="child-entities">Child entities</h4>
<p>The ELK <a href="../GLOSSARY.html#blueprint" class="glossary-term" title="A description of an application or system, which can be used for its automated
deployment and runtime management. The blueprint describes a model of the
application (i.e. its components, their configuration, and their
relationships), along with policies for runtime management. The blueprint can
be described in YAML or Java.">blueprint</a> also contains a good example of a child <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a>.</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> org.apache.brooklyn.entity.webapp.tomcat.Tomcat8Server
  brooklyn.config:
    children.startable.mode: background_late
  ...
  brooklyn.children:
<span class="hljs-attr">  - type:</span> logstash-child
</code></pre>
<p>In this example, a logstash-child is started as a child of the parent Tomcat server. The Tomcat server needs 
to be configured with a <code>children.startable.mode</code> to inform Brooklyn when to bring up the child. In this case
 we have selected background so that the child is disassociated from the parent <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a>, and late to specify that
  the parent <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a> should start before we start the child.</p>
<p>The example also shows how to configure Logstash inputs and filters, if necessary, for a particular application, 
in this case Tomcat.</p>
<pre><code class="lang-yaml"><span class="hljs-attr">- type:</span> logstash-child
<span class="hljs-attr">  name:</span> Logstash
  brooklyn.config:
    logstash.elasticsearch.hosts: $brooklyn:entity(<span class="hljs-string">&quot;es&quot;</span>).attributeWhenReady(<span class="hljs-string">&quot;urls.http.withBrackets&quot;</span>)
    logstash.config.input:
      $brooklyn:formatString:
<span class="hljs-bullet">      -</span> <span class="hljs-string">|
        input {
          file {
            path =&gt; &quot;%s/logs/localhost_access_log.*&quot;
            start_position =&gt; &quot;beginning&quot;
          }
        }
      - $brooklyn:entity(&quot;tomcat&quot;).attributeWhenReady(&quot;run.dir&quot;)
    logstash.config.filter: |
      filter {
        grok {
          match =&gt; { &quot;message&quot; =&gt; &quot;<span class="hljs-template-variable">%{COMBINEDAPACHELOG}</span>&quot; }
        }
        date {
          match =&gt; [ &quot;timestamp&quot; , &quot;dd/MMM/yyyy:HH:mm:ss Z&quot; ]
        }
      }
</span></code></pre>
<p>Configuring an appropriate visualisation on the Kibana server (access it via the URL on the summary tab for 
that <a href="../GLOSSARY.html#entity" class="glossary-term" title="A component of an application or system. This could be a physical component, a
service, a grouping of components, or a logical construct describing part of an
application/system. It is a &quot;managed element&quot; in autonomic computing parlance.">entity</a>) allows a dashboard to be created such as</p>
<p><img src="logstash-snapshot.png" alt="kibana dashboard"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"YAML Blueprint Advanced Example","level":"1.5.19","depth":2,"next":{"title":"Blueprinting Tips","level":"1.5.20","depth":2,"path":"blueprints/blueprinting-tips.md","ref":"blueprints/blueprinting-tips.md","articles":[]},"previous":{"title":"Creating Blueprints with Salt","level":"1.5.18.2","depth":3,"path":"blueprints/salt/creating-salt-blueprints.md","ref":"blueprints/salt/creating-salt-blueprints.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-highlight","theme-api","collapsible-chapters","bootstrap-callout","styles-less","versions","partial-summary"],"root":"./guide","styles":{"website":"website-1507894547703.css","pdf":"pdf-1507894547730.css"},"pluginsConfig":{"styles-less":{},"search":{},"collapsible-chapters":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"include-highlight":{"extensionToLanguage":{"yml":"yaml","yaml":"yaml","bom":"yaml","java":"java"}},"bootstrap-callout":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"theme-api":{"languages":[{"lang":"vagrant","name":"Vagrant","default":true},{"lang":"centos","name":"CentOS / RHEL 7"},{"lang":"ubuntu","name":"Ubuntu / Debian"},{"lang":"osx","name":"OSX / Linux"},{"lang":"windows","name":"Windows"},{"lang":"clouds","name":"Clouds"},{"lang":"byon","name":"BYON"},{"lang":"package","name":"RPM / DEB packages"},{"lang":"tarball","name":"Tarball"}],"split":false,"theme":"light"},"partial-summary":{"depth":0},"versions":{"type":"branches","gitbookConfigURL":"https://raw.githubusercontent.com/tbouron/brooklyn-docs/experiment/gitbook/book.json","options":[{"value":"https://brooklyn.apache.org/v/latest/","text":"Latest","selected":true},{"value":"https://brooklyn.apache.org/v/0.12.0/","text":"Version 0.12.0"},{"value":"https://brooklyn.apache.org/v/0.11.0/","text":"Version 0.11.0"},{"value":"https://brooklyn.apache.org/v/0.10.0/","text":"Version 0.10.0"},{"value":"https://brooklyn.apache.org/v/0.9.0/","text":"Version 0.9.0"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"brooklyn_version":"1.0.0-SNAPSHOT","brooklyn_version_stable":"0.12.0","url":{"brooklyn_website":"https://brooklyn.apache.org","brooklyn_javadoc":"https://brooklyn.apache.org"},"url_root":"http://0.0.0.0:4000"},"gitbook":"^3.2.3"},"file":{"path":"blueprints/advanced-example.md","mtime":"2017-10-12T15:26:25.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-10-13T11:35:45.585Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>


        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-versions/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

