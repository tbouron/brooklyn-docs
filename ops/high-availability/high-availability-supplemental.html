
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Configuring HA - an example Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../logging.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">User Guide</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Getting Started
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../start/running.html">
            
                <a href="../../start/running.html">
            
                    
                    Running Apache Brooklyn
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../start/blueprints.html">
            
                <a href="../../start/blueprints.html">
            
                    
                    Deploying Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../start/managing.html">
            
                <a href="../../start/managing.html">
            
                    
                    Monitoring and Managing Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../start/policies.html">
            
                <a href="../../start/policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../start/concept-quickstart.html">
            
                <a href="../../start/concept-quickstart.html">
            
                    
                    Concepts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../misc/download.html">
            
                <a href="../../misc/download.html">
            
                    
                    Downloads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Brooklyn Concepts
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../concepts/entities.html">
            
                <a href="../../concepts/entities.html">
            
                    
                    Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../concepts/application-parent-membership.html">
            
                <a href="../../concepts/application-parent-membership.html">
            
                    
                    Application, Parent and Membership
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../concepts/configuration-sensor-effectors.html">
            
                <a href="../../concepts/configuration-sensor-effectors.html">
            
                    
                    Configuration, Sensors and Effectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../concepts/lifecycle-managementcontext.html">
            
                <a href="../../concepts/lifecycle-managementcontext.html">
            
                    
                    Lifecycle and ManagementContext
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../concepts/dependent-configuration.html">
            
                <a href="../../concepts/dependent-configuration.html">
            
                    
                    Dependent Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../../concepts/location.html">
            
                <a href="../../concepts/location.html">
            
                    
                    Location
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../../concepts/policies.html">
            
                <a href="../../concepts/policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../../concepts/execution.html">
            
                <a href="../../concepts/execution.html">
            
                    
                    Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../../concepts/stop-start-restart-behaviour.html">
            
                <a href="../../concepts/stop-start-restart-behaviour.html">
            
                    
                    Stop/start/restart behaviour
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../blueprints/">
            
                <a href="../../blueprints/">
            
                    
                    Writing Blueprints
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../blueprints/creating-yaml.html">
            
                <a href="../../blueprints/creating-yaml.html">
            
                    
                    Creating YAML Blueprint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../blueprints/entity-configuration.html">
            
                <a href="../../blueprints/entity-configuration.html">
            
                    
                    Entity Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../blueprints/setting-locations.html">
            
                <a href="../../blueprints/setting-locations.html">
            
                    
                    Setting Locations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../../blueprints/configuring-vms.html">
            
                <a href="../../blueprints/configuring-vms.html">
            
                    
                    Configuring VMs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../../blueprints/multiple-services.html">
            
                <a href="../../blueprints/multiple-services.html">
            
                    
                    Multiple Services and Dependency Injection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../../blueprints/custom-entities.html">
            
                <a href="../../blueprints/custom-entities.html">
            
                    
                    Custom Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../../blueprints/catalog/">
            
                <a href="../../blueprints/catalog/">
            
                    
                    Catalog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../../blueprints/clusters.html">
            
                <a href="../../blueprints/clusters.html">
            
                    
                    Clusters, Specs, and Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../../blueprints/enrichers.html">
            
                <a href="../../blueprints/enrichers.html">
            
                    
                    Enrichers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../../blueprints/policies.html">
            
                <a href="../../blueprints/policies.html">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../../blueprints/effectors.html">
            
                <a href="../../blueprints/effectors.html">
            
                    
                    Effectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../../blueprints/clusters-and-policies.html">
            
                <a href="../../blueprints/clusters-and-policies.html">
            
                    
                    Clusters and Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../../blueprints/java/">
            
                <a href="../../blueprints/java/">
            
                    
                    Java Entities
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="../../blueprints/java/archetype.html">
            
                <a href="../../blueprints/java/archetype.html">
            
                    
                    Creating from a Maven Archetype
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.2" data-path="../../blueprints/java/defining-and-deploying.html">
            
                <a href="../../blueprints/java/defining-and-deploying.html">
            
                    
                    Defining and Deploying
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.3" data-path="../../blueprints/java/bundle-dependencies.html">
            
                <a href="../../blueprints/java/bundle-dependencies.html">
            
                    
                    Handling Bundle Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.4" data-path="../../blueprints/java/topology-dependencies.html">
            
                <a href="../../blueprints/java/topology-dependencies.html">
            
                    
                    Topology, Dependencies, and Management Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.5" data-path="../../blueprints/java/common-usage.html">
            
                <a href="../../blueprints/java/common-usage.html">
            
                    
                    Common Classes and Entities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.6" data-path="../../blueprints/java/feeds.html">
            
                <a href="../../blueprints/java/feeds.html">
            
                    
                    Feeds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.7" data-path="../../blueprints/java/entity.html">
            
                <a href="../../blueprints/java/entity.html">
            
                    
                    Writing an Entity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.8" data-path="../../blueprints/java/entities.html">
            
                <a href="../../blueprints/java/entities.html">
            
                    
                    Custom Entity Development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.9" data-path="../../blueprints/java/service-state.html">
            
                <a href="../../blueprints/java/service-state.html">
            
                    
                    Service State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.10" data-path="../../blueprints/java/entitlements.html">
            
                <a href="../../blueprints/java/entitlements.html">
            
                    
                    Entitlements
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../../blueprints/winrm/">
            
                <a href="../../blueprints/winrm/">
            
                    
                    Windows Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../../blueprints/test/">
            
                <a href="../../blueprints/test/">
            
                    
                    Testing YAML Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../../blueprints/ansible/">
            
                <a href="../../blueprints/ansible/">
            
                    
                    Ansible in YAML Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../../blueprints/chef/">
            
                <a href="../../blueprints/chef/">
            
                    
                    Chef in YAML Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="../../blueprints/salt/">
            
                <a href="../../blueprints/salt/">
            
                    
                    Salt in YAML Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.19" data-path="../../blueprints/advanced-example.html">
            
                <a href="../../blueprints/advanced-example.html">
            
                    
                    YAML Blueprint Advanced Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="../../blueprints/blueprinting-tips.html">
            
                <a href="../../blueprints/blueprinting-tips.html">
            
                    
                    Blueprinting Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21" data-path="../../blueprint/yaml-reference.md">
            
                <span>
            
                    
                    YAML Blueprint Reference
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../locations/">
            
                <a href="../../locations/">
            
                    
                    Deploying Blueprint
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../locations/">
            
                <a href="../../locations/#clouds">
            
                    
                    Clouds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../locations/">
            
                <a href="../../locations/#amazon-web-services-aws">
            
                    
                    Amazon Web Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../locations/">
            
                <a href="../../locations/#azure-compute-arm">
            
                    
                    Azure Compute ARM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../locations/">
            
                <a href="../../locations/#azure-compute-classic">
            
                    
                    Azure Compute Classic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../locations/">
            
                <a href="../../locations/#apache-cloudstack">
            
                    
                    Apache CloudStack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../locations/">
            
                <a href="../../locations/#google-compute-engine-gce">
            
                    
                    Google Compute Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../locations/">
            
                <a href="../../locations/#ibm-softlayer">
            
                    
                    IBM Softlayer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../locations/">
            
                <a href="../../locations/#openstack">
            
                    
                    OpenStack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../locations/">
            
                <a href="../../locations/#named-locations">
            
                    
                    Named Locations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../locations/">
            
                <a href="../../locations/#inheritance-and-named-locations">
            
                    
                    Provisioned Machine Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../locations/">
            
                <a href="../../locations/#byon">
            
                    
                    BYON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../locations/">
            
                <a href="../../locations/#ssh-keys">
            
                    
                    SSH Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../locations/">
            
                <a href="../../locations/#localhost">
            
                    
                    Localhost
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../locations/">
            
                <a href="../../locations/#location-customizers">
            
                    
                    Location Customizers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../../locations/">
            
                <a href="../../locations/#customizing-cloud-security-groups">
            
                    
                    Customizing Cloud Security Groups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../../locations/">
            
                <a href="../../locations/#specialized-locations">
            
                    
                    Specialized Locations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Reference Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../production-installation.html">
            
                <a href="../production-installation.html">
            
                    
                    Production Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../starting-stopping-monitoring.html">
            
                <a href="../starting-stopping-monitoring.html">
            
                    
                    Starting, Stopping and Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../server-cli-reference.html">
            
                <a href="../server-cli-reference.html">
            
                    
                    Server CLI Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../cli/">
            
                <a href="../cli/">
            
                    
                    Client CLI Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" >
            
                <span>
            
                    
                    GUI Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.5.1" data-path="../gui/running.html">
            
                <a href="../gui/running.html">
            
                    
                    Launching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.2" data-path="../gui/blueprints.html">
            
                <a href="../gui/blueprints.html">
            
                    
                    Deploying Blueprints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.3" data-path="../gui/managing.html">
            
                <a href="../gui/managing.html">
            
                    
                    Monitoring and Managing Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5.4" data-path="../gui/policies.html">
            
                <a href="../gui/policies.html">
            
                    
                    Using Policies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../rest.html">
            
                <a href="../rest.html">
            
                    
                    REST API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../configuration/">
            
                <a href="../configuration/">
            
                    
                    Brooklyn Configuration and Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../persistence/">
            
                <a href="../persistence/">
            
                    
                    Persistence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="./">
            
                <a href="./">
            
                    
                    High Availability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.7.9.1" data-path="high-availability-supplemental.html">
            
                <a href="high-availability-supplemental.html">
            
                    
                    Configuring HA - an example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../logging.html">
            
                <a href="../logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../externalized-configuration.html">
            
                <a href="../externalized-configuration.html">
            
                    
                    Externalized Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../requirements.html">
            
                <a href="../requirements.html">
            
                    
                    Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../upgrade.html">
            
                <a href="../upgrade.html">
            
                    
                    Upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../security-guidelines.html">
            
                <a href="../security-guidelines.html">
            
                    
                    Security Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../troubleshooting/">
            
                <a href="../troubleshooting/">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../misc/">
            
                <a href="../../misc/">
            
                    
                    Other 0.12.0 Resources
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developer Guide</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://brooklyn.apache.org/developers/code/">
            
                    
                    Get the Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../dev/env/maven-build.html">
            
                <a href="../../dev/env/maven-build.html">
            
                    
                    Maven Build
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../dev/env/ide/">
            
                <a href="../../dev/env/ide/">
            
                    
                    IDE Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../dev/code/structure.html">
            
                <a href="../../dev/code/structure.html">
            
                    
                    Code Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../dev/code/tests.html">
            
                <a href="../../dev/code/tests.html">
            
                    
                    Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../dev/code/licensing.html">
            
                <a href="../../dev/code/licensing.html">
            
                    
                    License Considerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../../dev/tips/">
            
                <a href="../../dev/tips/">
            
                    
                    Miscellaneous Tips and Tricks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../../dev/tips/logging.html">
            
                <a href="../../dev/tips/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../../dev/tips/debugging-remote-brooklyn.html">
            
                <a href="../../dev/tips/debugging-remote-brooklyn.html">
            
                    
                    Brooklyn Remote Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" >
            
                <a target="_blank" href="http://github.com/apache/brooklyn">
            
                    
                    GitHub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" >
            
                <a target="_blank" href="https://brooklyn.apache.org/v/latest/misc/javadoc">
            
                    
                    Javadoc
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://brooklyn.apache.org/meta/versions.html">
            
                    
                    Versions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <a target="_blank" href="https://brooklyn.apache.org/documentation/other-docs.html">
            
                    
                    Other Resources
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Configuring HA - an example</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>This supplements the <a href=".">High Availability</a> documentation
and provides an example of how to configure a pair of Apache Brooklyn servers to run in master-standby mode with a shared NFS datastore</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Two VMs (or physical machines) have been provisioned</li>
<li>NFS or another suitable file system has been configured and is available to both VMs*</li>
<li>An NFS folder has been mounted on both VMs at <code>/mnt/brooklyn-persistence</code> and both machines can write to the folder</li>
</ul>
<p>* Brooklyn can be configured to use either an object store such as S3, or a shared NFS mount. The recommended option is to use an object
store as described in the <a href="../persistence#object-store-persistence">Object Store Persistence</a> documentation. For simplicity, a shared NFS folder
is assumed in this example</p>
<h3 id="launching">Launching</h3>
<p>To start, download and install the latest Apache Brooklyn release on both VMs following the instructions in
<a href="../../guide/start/running.html">Running Apache Brooklyn</a></p>
<p>On the first VM, which will be the master node, set the following configuration options in <a href="../paths.html"><code>org.apache.brooklyn.osgilauncher.cfg</code></a>:</p>
<ul>
<li>highAvailabilityMode: MASTER</li>
<li>persistMode: AUTO</li>
<li>persistenceDir: /mnt/brooklyn-persistence</li>
</ul>
<p>Then launch Brooklyn with:</p>
<pre><code class="lang-bash">$ bin/start
</code></pre>
<p>If you are using RPMs/deb to install, please see the <a href="../../guide/start/running.html">Running Apache Brooklyn</a> 
documentation for the appropriate launch commands</p>
<p>Once Brooklyn has launched, on the second VM, set the following configuration options in <a href="../paths.html"><code>org.apache.brooklyn.osgilauncher.cfg</code></a>:</p>
<ul>
<li>highAvailabilityMode: AUTO</li>
<li>persistMode: AUTO</li>
<li>persistenceDir: /mnt/brooklyn-persistence</li>
</ul>
<p>Then launch the standby Brooklyn with:</p>
<pre><code class="lang-bash">$ bin/start
</code></pre>
<h3 id="failover">Failover</h3>
<p>When running as a HA standby node, each standby Brooklyn server (in this case there is only one standby) will check the shared persisted state
every one second to determine the state of the HA master. If no heartbeat has been recorded for 30 seconds, then an election will be performed
and one of the standby nodes will be promoted to master. At this point all requests should be directed to the new master node.
If the master is terminated gracefully, the secondary will be immediately promoted to mater. Otherwise, the secondary will be promoted after 
heartbeats are missed for a given length of time. This defaults to 30 seconds, and is configured in <code>brooklyn.cfg</code> using 
<code>brooklyn.ha.heartbeatTimeout</code></p>
<p>In the event that tasks - such as the provisioning of a new entity - are running when a failover occurs, the new master will display the current
state of the entity, but will not resume its provisioning or re-run any partially completed tasks. In this case it may be necessary
to remove the entity and reprovision it. In the case of a failover whilst executing a task called by an effector, it may be possible to simple
call the effector again</p>
<h3 id="client-configuration">Client Configuration</h3>
<p>It is the responsibility of the client to connect to the master Brooklyn server. This can be accomplished in a variety of ways:</p>
<ul>
<li><h3 id="reverse-proxy">Reverse Proxy</h3>
<p>To allow the client application to automatically fail over in the event of a master server becoming unavailable, or the promotion of a new master,
a reverse proxy can be configured to route traffic depending on the response returned by <code>https://&lt;ip-address&gt;:8443/v1/server/ha/state</code> (see above).
If a server returns <code>&quot;MASTER&quot;</code>, then traffic should be routed to that server, otherwise it should not be. The client software should be configured
to connect to the reverse proxy server and no action is required by the client in the event of a failover. It can take up to 30 seconds for the
standby to be promoted, so the reverse proxy should retry for at least this period, or the failover time should be reconfigured to be shorter</p>
</li>
<li><h3 id="re-allocating-an-elastic-ip-on-failover">Re-allocating an Elastic IP on Failover</h3>
<p>If the cloud provider you are using supports Elastic or Floating IPs, then the IP address should be allocated to the HA master, and the client
application configured to connect to the floating IP address. In the event of a failure of the master node, the standby node will automatically
be promoted to master, and the floating IP will need to be manually re-allocated to the new master node. No action is required by the client
in the event of a failover. It is possible to automate the re-allocation of the floating IP if the Brooklyn servers are deployed and managed
by Brooklyn using the entity <code>org.apache.brooklyn.entity.brooklynnode.BrooklynCluster</code></p>
</li>
<li><h3 id="client-based-failover">Client-based failover</h3>
<p>In this scenario, the responsibilty for determining the Brooklyn master server falls on the client application. When configuring the client
application, a list of all servers in the cluster is passed in at application startup. On first connection, the client application connects to
any of the members of the cluster to retrieve the HA states (see above). The JSON object returned is used to determine the addresses of all
members of the cluster, and also to determine which node is the HA master</p>
<p>In the event of a failure of the master node, the client application should then retrieve the HA states of the cluster from any of the other cluster
members. This is the same process as when the application first connects to the cluster. The client should refresh its list of cluster memebers
and determine which node is the HA master</p>
<p>It is also recommended that the client application periodically checks the status of the cluster and updates its list of addresses. This will
ensure that failover is still possible if the standby server(s) has been replaced. It also allows additional standby servers to be added at any
time</p>
</li>
</ul>
<h3 id="testing">Testing</h3>
<p>You can confirm that Brooklyn is running in high availibility mode on the master by logging into the web console at <code>https://&lt;ip-address&gt;:8443</code>.
Similarly you can log into the web console on the standby VM where you will see a warning that the server is not the high availability master.</p>
<p>To test a failover, you can simply terminate the process on the first VM and log into the web console on the second VM. Upon launch, Brooklyn will
output its PID to the file <code>pid.txt</code>; you can force an immediate (non-graceful) termination of the process by running the following command 
from the same directory from which you launched Brooklyn:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">kill</span> -9 $(cat pid.txt)
</code></pre>
<p>It is also possiblity to check the high availability state of a running Brooklyn server using the following curl command:</p>
<pre><code class="lang-bash">$ curl -k -u myusername:mypassword https://&lt;ip-address&gt;:8443/v1/server/ha/state
</code></pre>
<p>This will return one of the following states:</p>
<pre><code class="lang-bash">
<span class="hljs-string">&quot;INITIALIZING&quot;</span>
<span class="hljs-string">&quot;STANDBY&quot;</span>
<span class="hljs-string">&quot;HOT_STANDBY&quot;</span>
<span class="hljs-string">&quot;HOT_BACKUP&quot;</span>
<span class="hljs-string">&quot;MASTER&quot;</span>
<span class="hljs-string">&quot;FAILED&quot;</span>
<span class="hljs-string">&quot;TERMINATED&quot;</span>
</code></pre>
<p>Note: The quotation characters will be included in the reply</p>
<p>To obtain information about all of the nodes in the cluster, run the following command against any of the nodes in the cluster:</p>
<pre><code class="lang-bash">$ curl -k -u myusername:mypassword https://&lt;ip-address&gt;:8443/v1/server/ha/states
</code></pre>
<p>This will return a JSON document describing the Brooklyn nodes in the cluster. An example of two HA Brooklyn nodes is as follows (whitespace formatting has been
added for clarity):</p>
<pre><code class="lang-yaml">
{
<span class="hljs-attr">  ownId:</span> <span class="hljs-string">&quot;XkJeXUXE&quot;</span>,
<span class="hljs-attr">  masterId:</span> <span class="hljs-string">&quot;yAVz0fzo&quot;</span>,
<span class="hljs-attr">  nodes:</span> {
<span class="hljs-attr">    yAVz0fzo:</span> {
<span class="hljs-attr">      nodeId:</span> <span class="hljs-string">&quot;yAVz0fzo&quot;</span>,
<span class="hljs-attr">      nodeUri:</span> <span class="hljs-string">&quot;https://&lt;server1-ip-address&gt;:8443/&quot;</span>,
<span class="hljs-attr">      status:</span> <span class="hljs-string">&quot;MASTER&quot;</span>,
<span class="hljs-attr">      localTimestamp:</span> <span class="hljs-number">1466414301065</span>,
<span class="hljs-attr">      remoteTimestamp:</span> <span class="hljs-number">1466414301000</span>
    },
<span class="hljs-attr">    XkJeXUXE:</span> {
<span class="hljs-attr">      nodeId:</span> <span class="hljs-string">&quot;XkJeXUXE&quot;</span>,
<span class="hljs-attr">      nodeUri:</span> <span class="hljs-string">&quot;https://&lt;server2-ip-address&gt;:8443/&quot;</span>,
<span class="hljs-attr">      status:</span> <span class="hljs-string">&quot;STANDBY&quot;</span>,
<span class="hljs-attr">      localTimestamp:</span> <span class="hljs-number">1466414301066</span>,
<span class="hljs-attr">      remoteTimestamp:</span> <span class="hljs-number">1466414301000</span>
    }
  },
<span class="hljs-attr">  links:</span> { }
}
</code></pre>
<p>The examples above show how to use <code>curl</code> to manually check the status of Brooklyn via its REST API. The same REST API calls can also be used by
automated third party monitoring tools such as Nagios </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Configuring HA - an example","layout":"website-normal","level":"1.7.9.1","depth":3,"next":{"title":"Logging","level":"1.7.10","depth":2,"path":"ops/logging.md","ref":"ops/logging.md","articles":[]},"previous":{"title":"High Availability","level":"1.7.9","depth":2,"path":"ops/high-availability/index.md","ref":"ops/high-availability/index.md","articles":[{"title":"Configuring HA - an example","level":"1.7.9.1","depth":3,"path":"ops/high-availability/high-availability-supplemental.md","ref":"ops/high-availability/high-availability-supplemental.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["include-highlight","theme-api"],"root":"./guide","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"include-highlight":{"extensionToLanguage":{"yml":"yaml","yaml":"yaml","bom":"yaml","java":"java"}},"theme-api":{"languages":[{"lang":"vagrant","name":"Vagrant","default":true},{"lang":"centos","name":"CentOS / RHEL 7"},{"lang":"ubuntu","name":"Ubuntu / Debian"},{"lang":"osx","name":"OSX / Linux"},{"lang":"windows","name":"Windows"}],"split":false,"theme":"light"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"path":{"style":"/style","guide":"/guide","website":"/website","v":"/v"},"pdf-default-versioned-url-subpath":"/v/0.11.0","brooklyn-stable-version":"0.11.0","sass":{"sass_dir":"style/css"},"markdown":"kramdown","brooklyn-version":"0.13.0-SNAPSHOT","url_root":"http://0.0.0.0:4000","root_menu_page":"/website/index.md","encoding":"utf-8","dependency_mode":"local","dependency_urls":{"bootstrap.css":"https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css","bootstrap.js":"https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js","jquery.js":"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"},"exclude":["/Gemfile*","/README.md"],"pdf-default-base-url":"http://brooklyn.apache.org","pdf-rewrite-prefixes":{"/guide":"/v/0.11.0","/website":""},"brooklyn-snapshot-git-branch":"master"},"gitbook":"*"},"file":{"path":"ops/high-availability/high-availability-supplemental.md","mtime":"2017-10-06T11:31:52.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-10-06T11:32:19.198Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

